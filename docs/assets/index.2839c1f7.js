import{C as e,B as t,S as n,R as r,a as o}from"./vendor.338242af.js";!function(e=".",t="__import__"){try{self[t]=new Function("u","return import(u)")}catch(n){const r=new URL(e,location),o=e=>{URL.revokeObjectURL(e.src),e.remove()};self[t]=e=>new Promise(((n,c)=>{const a=new URL(e,r);if(self[t].moduleMap[a])return n(self[t].moduleMap[a]);const s=new Blob([`import * as m from '${a}';`,`${t}.moduleMap['${a}']=m;`],{type:"text/javascript"}),i=Object.assign(document.createElement("script"),{type:"module",src:URL.createObjectURL(s),onerror(){c(new Error(`Failed to import: ${e}`)),o(i)},onload(){n(self[t].moduleMap[a]),o(i)}});document.head.appendChild(i)})),self[t].moduleMap={}}}("/assets/");const c=t=>{const[n,r]=e.useState(),o=e.useRef();return e.createElement("div",null,e.createElement("input",{type:"text",name:"name",ref:o}),e.createElement("button",{onClick:e=>{r(o.current.value)}},"Save Name"),e.createElement("br",null),e.createElement("button",{onClick:async e=>{e.preventDefault();const n=await fetch("https://golang-webchat-server.sg.aldhaneka.me/create"),{room_id:r}=await n.json();t.history.push(`/room/${r}`)}},"Create Room"))},a=t=>{const n=e.useRef(),r=e.useRef(),o=e.useRef(),c=e.useRef(),a=e.useRef(),[s,i]=e.useState();e.useEffect((()=>{r.current||n.current.srcObject||(async()=>{const e=(await navigator.mediaDevices.enumerateDevices()).filter((e=>"videoinput"==e.kind));console.log(e);const t={audio:!0,video:{deviceId:e[0].deviceId}};try{return await navigator.mediaDevices.getUserMedia(t)}catch(n){console.log(n)}})().then((e=>{console.log("stream",e),n.current.srcObject=e,r.current=e,a.current=new WebSocket(`wss://golang-webchat-server.sg.aldhaneka.me/join?roomID=${t.match.params.roomID}`),a.current.addEventListener("close",(e=>{console.log("CLOSE! ",e),a.current.send(JSON.stringify({message:"woee"}))})),a.current.addEventListener("open",(()=>{a.current.send(JSON.stringify({ask:!0}))})),a.current.addEventListener("message",(async e=>{console.log("on message ",e);const t=JSON.parse(e.data);if(t.join&&t.participantId)u();else if(t.participantId)i(t.participantId);else if(t.offer&&d(t.offer),t.answer&&(console.log("Receiving Answer"),c.current.setRemoteDescription(new RTCSessionDescription(t.answer))),t.iceCandidate){console.log("Receiving and Adding ICE Candidate");try{console.log("PEER REF: ",c.current),await c.current.addIceCandidate(t.iceCandidate)}catch(n){console.log(c.current),console.log("Error Receiving ICE Candidate",n)}}}))}))})),e.useEffect((()=>{console.log("hey!",s),s&&(l(),a.current.send(JSON.stringify({join:!0,participantId:s})))}),[s]);const l=()=>{r.current.getTracks().forEach((async e=>{console.log("track: ",e)}))},d=async e=>{console.log("Received Offer, Creating Answer"),c.current||(c.current=m()),await c.current.setRemoteDescription(new RTCSessionDescription(e)),console.log("Send Track"),r.current.getTracks().forEach((async e=>{console.log("track: ",e),c.current.addTrack(e,r.current)}));const t=await c.current.createAnswer();await c.current.setLocalDescription(t),console.log("Send Answer"),a.current.send(JSON.stringify({answer:c.current.localDescription}))},u=()=>{console.log("Calling Other User"),c.current=m(),r.current.getTracks().forEach((e=>{console.log("track: ",e),c.current.addTrack(e,r.current)}))},m=()=>{console.log("Creating Peer Connection");const e=new RTCPeerConnection({iceServers:[{urls:"stun:stun.l.google.com:19302"},{urls:"turn:openrelay.metered.ca:443?transport=tcp",username:"openrelayproject",credential:"openrelayproject"}]});return e.onnegotiationneeded=g,e.onicecandidate=p,e.ontrack=f,console.log("PEER: ",e),e},g=async()=>{console.log("Creating Offer");try{const e=await c.current.createOffer();await c.current.setLocalDescription(e),a.current.send(JSON.stringify({offer:c.current.localDescription}))}catch(e){}},p=e=>{console.log("Found Ice Candidate"),e.candidate&&(console.log(e.candidate),a.current.send(JSON.stringify({iceCandidate:e.candidate})))},f=e=>{console.log("Received Tracks"),console.log("Stream: ",e),o.current.srcObject=e.streams[0],console.log(o.current.srcObject)};return e.createElement("div",null,e.createElement("video",{autoPlay:!0,controls:!0,ref:n}),e.createElement("video",{autoPlay:!0,controls:!0,ref:o}))};function s(){return e.createElement("div",{className:"App"},e.createElement(t,null,e.createElement(n,null,e.createElement(r,{path:"/",exact:!0,component:c}),e.createElement(r,{path:"/room/:roomID",component:a}))))}o.render(e.createElement(e.StrictMode,null,e.createElement(s,null)),document.getElementById("root"));
